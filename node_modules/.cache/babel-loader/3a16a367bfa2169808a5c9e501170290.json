{"remainingRequest":"C:\\Users\\xiaoxi\\Desktop\\毕业设计\\Mr.Qin\\DivineChoice\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\xiaoxi\\Desktop\\毕业设计\\Mr.Qin\\DivineChoice\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\xiaoxi\\Desktop\\毕业设计\\Mr.Qin\\DivineChoice\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\xiaoxi\\Desktop\\毕业设计\\Mr.Qin\\DivineChoice\\src\\views\\student\\alter\\alterMessage.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\xiaoxi\\Desktop\\毕业设计\\Mr.Qin\\DivineChoice\\src\\views\\student\\alter\\alterMessage.vue","mtime":1618719235115},{"path":"C:\\Users\\xiaoxi\\Desktop\\毕业设计\\Mr.Qin\\DivineChoice\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616485460902},{"path":"C:\\Users\\xiaoxi\\Desktop\\毕业设计\\Mr.Qin\\DivineChoice\\node_modules\\babel-loader\\lib\\index.js","mtime":1616485540067},{"path":"C:\\Users\\xiaoxi\\Desktop\\毕业设计\\Mr.Qin\\DivineChoice\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616485460902},{"path":"C:\\Users\\xiaoxi\\Desktop\\毕业设计\\Mr.Qin\\DivineChoice\\node_modules\\vue-loader\\lib\\index.js","mtime":1616485526728}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.regexp.split\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport axios from 'axios';\nimport { Message } from 'element-ui';\n\nfunction insertStr(soure, firstPosition, firstStr, secondPosition, secondStr) {\n  soure = soure.slice(0, firstPosition) + firstStr + soure.slice(firstPosition);\n  return soure.slice(0, secondPosition) + secondStr + soure.slice(secondPosition);\n}\n\nexport default {\n  name: 'AlterMessage',\n  data: function data() {\n    var _this = this;\n\n    var checkID_Card = function checkID_Card(rule, value, callback) {\n      if (value.length !== 18) {\n        callback(new Error('身份证号长度不正确'));\n      } else {\n        if (!/^\\d{17}(\\d|x)$/i.test(value)) {\n          callback(new Error('身份证号格式不正确'));\n        } else {\n          // console.log(value.substring(6,14))\n          if (!/^(19|20)\\d{2}(1[0-2]|0[1-9])(0[1-9]|[1-2][0-9]|3[0-1])$/i.test(value.substring(6, 14))) {\n            callback(new Error('请检查生日'));\n          }\n\n          var arr = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];\n          var arr2 = value.split('');\n          var total = 0;\n\n          for (var i = 0; i < arr.length; i++) {\n            total += ~~arr[i] * ~~arr2[i];\n          } // 校验码\n          // console.log(total % 11)\n          //最后一位的值\n\n\n          var answer = [1, 0, 'X', 9, 8, 7, 6, 5, 4, 3, 2][total % 11];\n\n          if (answer === Number(arr2[17])) {\n            if (arr2[16] % 2 === 1) {\n              _this.userMessageform.sex = '男';\n            } else {\n              _this.userMessageform.sex = '女';\n            }\n\n            var birthday = _this.userMessageform.ID_Card.substring(6, 14);\n\n            var newBirthday = insertStr(birthday, 4, '-', 7, '-');\n            _this.userMessageform.birthday = newBirthday;\n            callback();\n          } else {\n            callback(new Error('身份证号输入错误'));\n          }\n        }\n      }\n    };\n\n    var checkSex = function checkSex(rule, value, callback) {\n      if (value === '男') {\n        value = 1;\n      } else {\n        value = 0;\n      }\n\n      var arr = _this.userMessageform.ID_Card.split('');\n\n      if (value !== Number(arr[16] % 2)) {\n        callback(new Error('与身份证号不符合'));\n      }\n\n      callback();\n    };\n\n    var checkBirthday = function checkBirthday(rule, value, callback) {\n      // console.log(value)\n      var birthday = _this.userMessageform.ID_Card.substring(6, 14);\n\n      var newBirthday = insertStr(birthday, 4, '-', 7, '-'); // console.log(newBirthday)\n\n      if (value !== newBirthday) {\n        callback(new Error('与身份证号不符合'));\n      }\n\n      callback();\n    };\n\n    var checkPhone = function checkPhone(rule, value, callback) {\n      if (!/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\\d{8}$/.test(value)) {\n        callback(new Error('手机号有误，请重填'));\n      }\n\n      callback();\n    };\n\n    var checkEmail = function checkEmail(rule, value, callback) {\n      var patten = /^([a-zA-Z0-9]+[_|_|\\-|.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|_|.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/;\n\n      if (!patten.test(value)) {\n        callback(new Error('邮箱有误，请重填'));\n      }\n\n      callback();\n    };\n\n    var checkRemark = function checkRemark(rule, value, callback) {\n      callback();\n    };\n\n    return {\n      userMessageform: {\n        user: JSON.parse(this.$store.state.token),\n        ID_Card: '',\n        sex: '',\n        birthday: '',\n        phone: '',\n        email: '',\n        remark: ''\n      },\n      // 为表单验证\n      rules: {\n        ID_Card: [{\n          validator: checkID_Card,\n          trigger: 'change'\n        }],\n        sex: [{\n          validator: checkSex,\n          trigger: 'change'\n        }],\n        birthday: [{\n          validator: checkBirthday,\n          trigger: 'blur'\n        }],\n        phone: [{\n          validator: checkPhone,\n          trigger: 'blur'\n        }],\n        email: [{\n          validator: checkEmail,\n          trigger: 'change'\n        }],\n        remark: [{\n          validator: checkRemark,\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  methods: {\n    onSubmit: function onSubmit(userMessageform) {\n      var _this2 = this;\n\n      // 为表单绑定验证功能\n      this.$refs[userMessageform].validate(function (valid) {\n        // 当用户，没有按照规则填写登录信息，就会是false\n        if (valid) {\n          _this2.$confirm('此操作将修改个人信息, 是否继续?', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }).then(function () {\n            // 开始获取个人信息\n            var that = _this2;\n            axios.put(\"http://localhost:8080/api/studentInfos/updateByPrimaryKeyChangeMessage\", {\n              student_id: JSON.parse(_this2.$store.state.token).student_id,\n              password: JSON.parse(_this2.$store.state.token).password,\n              name: JSON.parse(_this2.$store.state.token).name,\n              id_card: _this2.userMessageform.ID_Card,\n              sex: _this2.userMessageform.sex,\n              birthday: _this2.userMessageform.birthday,\n              phone: _this2.userMessageform.phone,\n              email: _this2.userMessageform.email,\n              remark: _this2.userMessageform.remark\n            }).then(function (response) {\n              Message.success(\"更新成功\"); // 随之更新token\n\n              that.$store.commit('$_setToken', JSON.stringify(response.data));\n            }).catch(function (error) {\n              Message.error(\"请检查网络\");\n            });\n          }).catch(function () {\n            _this2.$message({\n              type: 'error',\n              message: '已取消修改'\n            });\n          });\n        }\n      });\n    }\n  },\n  mounted: function mounted() {\n    // 自动填充 \n    this.userMessageform.ID_Card = JSON.parse(this.$store.state.token).id_card;\n    this.userMessageform.sex = JSON.parse(this.$store.state.token).sex;\n    this.userMessageform.birthday = JSON.parse(this.$store.state.token).birthday;\n    this.userMessageform.phone = JSON.parse(this.$store.state.token).phone;\n    this.userMessageform.email = JSON.parse(this.$store.state.token).email;\n    this.userMessageform.remark = JSON.parse(this.$store.state.token).remark;\n  }\n};",{"version":3,"sources":["alterMessage.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n\t<div style=\"margin-left: 30%;margin-top: 20px;\">\r\n\t\t<el-form label-width=\"80px\" :model=\"userMessageform\" ref=\"userMessageform\" :rules=\"rules\">\r\n\t\t\t<!-- <div style=\"float: left;\"> -->\r\n\t\t\t<el-form-item label=\"学号\">\r\n\t\t\t\t<el-input v-model=\"userMessageform.user.student_id\" :disabled=\"true\" prefix-icon=\"el-icon-user\">\r\n\t\t\t\t</el-input>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"姓名\">\r\n\t\t\t\t<el-input v-model=\"userMessageform.user.name\" :disabled=\"true\">\r\n\t\t\t\t\t<i slot=\"prefix\" class=\"iconfont iconziwopingjia\" style=\"margin-left: 4px;\"></i>\r\n\t\t\t\t</el-input>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"身份证号\" prop=\"ID_Card\">\r\n\t\t\t\t<el-input v-model=\"userMessageform.ID_Card\" placeholder=\"身份证号\">\r\n\t\t\t\t\t<i slot=\"prefix\" class=\"iconfont iconshenfenzheng\"></i>\r\n\t\t\t\t</el-input>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"性别\" prop=\"sex\">\r\n\r\n\t\t\t\t<el-select placeholder=\"性别\" style=\"width: 200px;\" v-model=\"userMessageform.sex\">\r\n\t\t\t\t\t<i slot=\"prefix\" class=\"iconfont iconxingbie\" style=\"margin-left: 4px;\"></i>\r\n\t\t\t\t\t<el-option label=\"男\" value=\"男\"></el-option>\r\n\t\t\t\t\t<el-option label=\"女\" value=\"女\"></el-option>\r\n\t\t\t\t</el-select>\r\n\t\t\t</el-form-item>\r\n\t\t\t<!-- </div> -->\r\n\t\t\t<!-- <div style=\"float: right;margin-right: 15%;\"> -->\r\n\t\t\t<el-form-item label=\"出生日期\" prop=\"birthday\">\r\n\t\t\t\t<el-date-picker type=\"date\" placeholder=\"选择日期\" v-model=\"userMessageform.birthday\"\r\n\t\t\t\t\tvalue-format=\"yyyy-MM-dd\" style=\"width: 200px;\"></el-date-picker>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"电话\" prop=\"phone\">\r\n\t\t\t\t<el-input v-model=\"userMessageform.phone\" placeholder=\"电话\">\r\n\t\t\t\t\t<i slot=\"prefix\" class=\"iconfont icondianhua\"></i>\r\n\t\t\t\t</el-input>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"邮箱\" prop=\"email\">\r\n\t\t\t\t<el-input v-model=\"userMessageform.email\" placeholder=\"邮箱\">\r\n\t\t\t\t\t<i slot=\"prefix\" class=\"iconfont iconyouxiang\"></i>\r\n\t\t\t\t</el-input>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"自我评价\" prop=\"remark\">\r\n\t\t\t\t<el-input v-model=\"userMessageform.remark\" type=\"textarea\" placeholder=\"自我评价\" style=\"width: 400px;\"\r\n\t\t\t\t\trows=\"5\">\r\n\t\t\t\t</el-input>\r\n\t\t\t</el-form-item>\r\n\t\t\t<!-- </div> -->\r\n\t\t\t<!-- <div style=\"margin-left: 200px;\"> -->\r\n\t\t\t<el-form-item style=\"margin-top: -14px;\">\r\n\t\t\t\t<el-button type=\"primary\" round style=\"width: 150px;\" @click=\"onSubmit('userMessageform')\"\r\n\t\t\t\t\t:plain=\"true\">\r\n\t\t\t\t\t修改个人信息\r\n\t\t\t\t</el-button>\r\n\t\t\t</el-form-item>\r\n\t\t\t<!-- </div> -->\r\n\t\t</el-form>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport axios from 'axios';\r\n\timport {\r\n\t\tMessage\r\n\t} from 'element-ui';\r\n\r\n\r\n\tfunction insertStr(soure, firstPosition, firstStr, secondPosition, secondStr) {\r\n\t\tsoure = soure.slice(0, firstPosition) + firstStr + soure.slice(firstPosition)\r\n\t\treturn soure.slice(0, secondPosition) + secondStr + soure.slice(secondPosition)\r\n\t}\r\n\r\n\texport default {\r\n\t\tname: 'AlterMessage',\r\n\t\tdata() {\r\n\t\t\tvar checkID_Card = (rule, value, callback) => {\r\n\t\t\t\tif (value.length !== 18) {\r\n\t\t\t\t\tcallback(new Error('身份证号长度不正确'))\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!/^\\d{17}(\\d|x)$/i.test(value)) {\r\n\t\t\t\t\t\tcallback(new Error('身份证号格式不正确'))\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// console.log(value.substring(6,14))\r\n\t\t\t\t\t\tif (!/^(19|20)\\d{2}(1[0-2]|0[1-9])(0[1-9]|[1-2][0-9]|3[0-1])$/i.test(value.substring(6, 14))) {\r\n\t\t\t\t\t\t\tcallback(new Error('请检查生日'))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar arr = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2]\r\n\t\t\t\t\t\tvar arr2 = value.split('');\r\n\t\t\t\t\t\tvar total = 0;\r\n\t\t\t\t\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\t\t\t\t\ttotal += ~~arr[i] * ~~arr2[i]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 校验码\r\n\t\t\t\t\t\t// console.log(total % 11)\r\n\t\t\t\t\t\t//最后一位的值\r\n\t\t\t\t\t\tvar answer = [1, 0, 'X', 9, 8, 7, 6, 5, 4, 3, 2][total % 11]\r\n\t\t\t\t\t\tif (answer === Number(arr2[17])) {\r\n\t\t\t\t\t\t\tif (arr2[16] % 2 === 1) {\r\n\t\t\t\t\t\t\t\tthis.userMessageform.sex = '男'\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.userMessageform.sex = '女'\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar birthday = this.userMessageform.ID_Card.substring(6, 14)\r\n\t\t\t\t\t\t\tvar newBirthday = insertStr(birthday, 4, '-', 7, '-')\r\n\t\t\t\t\t\t\tthis.userMessageform.birthday = newBirthday\r\n\r\n\r\n\t\t\t\t\t\t\tcallback()\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcallback(new Error('身份证号输入错误'))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar checkSex = (rule, value, callback) => {\r\n\r\n\t\t\t\tif (value === '男') {\r\n\t\t\t\t\tvalue = 1\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = 0\r\n\t\t\t\t}\r\n\t\t\t\tvar arr = this.userMessageform.ID_Card.split('');\r\n\t\t\t\tif (value !== Number(arr[16] % 2)) {\r\n\t\t\t\t\tcallback(new Error('与身份证号不符合'))\r\n\t\t\t\t}\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\r\n\t\t\tvar checkBirthday = (rule, value, callback) => {\r\n\t\t\t\t// console.log(value)\r\n\r\n\t\t\t\tvar birthday = this.userMessageform.ID_Card.substring(6, 14)\r\n\t\t\t\tvar newBirthday = insertStr(birthday, 4, '-', 7, '-')\r\n\t\t\t\t// console.log(newBirthday)\r\n\t\t\t\tif (value !== newBirthday) {\r\n\t\t\t\t\tcallback(new Error('与身份证号不符合'))\r\n\t\t\t\t}\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\r\n\t\t\tvar checkPhone = (rule, value, callback) => {\r\n\t\t\t\tif (!/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\\d{8}$/.test(value)) {\r\n\t\t\t\t\tcallback(new Error('手机号有误，请重填'))\r\n\t\t\t\t}\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\r\n\r\n\t\t\tvar checkEmail = (rule, value, callback) => {\r\n\t\t\t\tvar patten =\r\n\t\t\t\t\t/^([a-zA-Z0-9]+[_|_|\\-|.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|_|.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/;\r\n\t\t\t\tif (!patten.test(value)) {\r\n\t\t\t\t\tcallback(new Error('邮箱有误，请重填'))\r\n\t\t\t\t}\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\r\n\t\t\tvar checkRemark = (rule, value, callback) => {\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t\treturn {\r\n\t\t\t\tuserMessageform: {\r\n\t\t\t\t\tuser: JSON.parse(this.$store.state.token),\r\n\t\t\t\t\tID_Card: '',\r\n\t\t\t\t\tsex: '',\r\n\t\t\t\t\tbirthday: '',\r\n\t\t\t\t\tphone: '',\r\n\t\t\t\t\temail: '',\r\n\t\t\t\t\tremark: ''\r\n\t\t\t\t},\r\n\t\t\t\t// 为表单验证\r\n\t\t\t\trules: {\r\n\t\t\t\t\tID_Card: [{\r\n\t\t\t\t\t\tvalidator: checkID_Card,\r\n\t\t\t\t\t\ttrigger: 'change'\r\n\t\t\t\t\t}],\r\n\t\t\t\t\tsex: [{\r\n\t\t\t\t\t\tvalidator: checkSex,\r\n\t\t\t\t\t\ttrigger: 'change'\r\n\t\t\t\t\t}],\r\n\t\t\t\t\tbirthday: [{\r\n\t\t\t\t\t\tvalidator: checkBirthday,\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t}],\r\n\t\t\t\t\tphone: [{\r\n\t\t\t\t\t\tvalidator: checkPhone,\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t}],\r\n\t\t\t\t\temail: [{\r\n\t\t\t\t\t\tvalidator: checkEmail,\r\n\t\t\t\t\t\ttrigger: 'change'\r\n\t\t\t\t\t}],\r\n\t\t\t\t\tremark: [{\r\n\t\t\t\t\t\tvalidator: checkRemark,\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t}]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tonSubmit(userMessageform) {\r\n\t\t\t\t// 为表单绑定验证功能\r\n\t\t\t\tthis.$refs[userMessageform].validate((valid) => {\r\n\r\n\t\t\t\t\t// 当用户，没有按照规则填写登录信息，就会是false\r\n\t\t\t\t\tif (valid) {\r\n\r\n\t\t\t\t\t\tthis.$confirm('此操作将修改个人信息, 是否继续?', '提示', {\r\n\t\t\t\t\t\t\tconfirmButtonText: '确定',\r\n\t\t\t\t\t\t\tcancelButtonText: '取消',\r\n\t\t\t\t\t\t\ttype: 'warning'\r\n\t\t\t\t\t\t}).then(() => {\r\n\t\t\t\t\t\t\t// 开始获取个人信息\r\n\t\t\t\t\t\t\tlet that = this\r\n\t\t\t\t\t\t\taxios.put(\r\n\t\t\t\t\t\t\t\t\"http://localhost:8080/api/studentInfos/updateByPrimaryKeyChangeMessage\", {\r\n\t\t\t\t\t\t\t\t\tstudent_id: JSON.parse(this.$store.state.token).student_id,\r\n\t\t\t\t\t\t\t\t\tpassword: JSON.parse(this.$store.state.token).password,\r\n\t\t\t\t\t\t\t\t\tname: JSON.parse(this.$store.state.token).name,\r\n\t\t\t\t\t\t\t\t\tid_card: this.userMessageform.ID_Card,\r\n\t\t\t\t\t\t\t\t\tsex: this.userMessageform.sex,\r\n\t\t\t\t\t\t\t\t\tbirthday: this.userMessageform.birthday,\r\n\t\t\t\t\t\t\t\t\tphone: this.userMessageform.phone,\r\n\t\t\t\t\t\t\t\t\temail: this.userMessageform.email,\r\n\t\t\t\t\t\t\t\t\tremark: this.userMessageform.remark\r\n\t\t\t\t\t\t\t\t}).then(function(response) {\r\n\r\n\t\t\t\t\t\t\t\tMessage.success(\"更新成功\")\r\n\t\t\t\t\t\t\t\t// 随之更新token\r\n\t\t\t\t\t\t\t\tthat.$store.commit('$_setToken', JSON.stringify(response.data));\r\n\r\n\r\n\t\t\t\t\t\t\t}).catch(function(error) {\r\n\t\t\t\t\t\t\t\tMessage.error(\"请检查网络\")\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t}).catch(() => {\r\n\t\t\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\t\t\tmessage: '已取消修改'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\t// 自动填充 \r\n\t\t\tthis.userMessageform.ID_Card = JSON.parse(this.$store.state.token).id_card\r\n\t\t\tthis.userMessageform.sex = JSON.parse(this.$store.state.token).sex\r\n\t\t\tthis.userMessageform.birthday = JSON.parse(this.$store.state.token).birthday\r\n\t\t\tthis.userMessageform.phone = JSON.parse(this.$store.state.token).phone\r\n\t\t\tthis.userMessageform.email = JSON.parse(this.$store.state.token).email\r\n\t\t\tthis.userMessageform.remark = JSON.parse(this.$store.state.token).remark\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style scoped=\"scoped\">\r\n\t.el-input {\r\n\t\twidth: 200px;\r\n\t}\r\n</style>\n"],"sourceRoot":"src/views/student/alter"}]}